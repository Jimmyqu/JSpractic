<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
    <script src="https://unpkg.com/vuex"></script>
</head>
<body>
    <div id="app" style="background-color: beige;width: 400px;height: 400px">
        {{msg}}
        {{count}}
        <child></child>
    </div>

    <template id="child">
        <div style="background-color:darkgoldenrod;width: 200px;height: 200px" >
            <button @click="add">add</button>
            <button @click="Sub">Sub</button>
        </div>
    </template>

    <script>



        const store = new Vuex.Store({
            state: {
                count: 0
            },
            mutations: {  //唯一能改变state的方法
                increment (state) {
                    state.count++
                },

                sub(state){
                    state.count--
                    // console.log(state.count)
                }
            },
            actions: {  //定义改变state的方法 实际是通过mutations
                incrementAsync(context) {
                    //action内部可以做异步操作
                    setTimeout(()=>context.commit('increment'),2000)
                    //context.commit('increment')
                }
            }
        });


        Vue.component('child',{
            template:'#child',
            data(){
                return {
                    childMsg:'rrrrr'
                }
            },
            methods:{
                // add () {  //子组件内调用 store的 mutations方法改变state
                //     store.commit('increment')
                //     // setTimeout(store.commit('increment'),2000) // 异步无效
                // },
                add () {
                    store.dispatch('incrementAsync')  //分发action
                },
                Sub(){
                    store.commit('sub')
                }
            }
        });

        new Vue({
            el:'#app',
            data:{
                msg:'222'
            },
            computed:{
                count(){
                   return store.state.count
                },
            },
            // computed:Vuex.mapState({
            //     count:state => state.count,
            // })
        })

    </script>
</body>
</html>