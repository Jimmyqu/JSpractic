<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Title</title>
    <link
      href="https://unpkg.com/tailwindcss@^2/dist/tailwind.min.css"
      rel="stylesheet"
    />
    <style>
       .box {
            position: absolute;
        }
    </style>
  </head>
  <body>
    <h4>test</h4>
    <div class="flex container">
      <div class="w-8/12 bg-green-100">
      </div>
      <div>
        <div class="one">单行</div>
        <div class="many">多行</div>
        <div class="upload">图片</div>
      </div>
    </div>

    <script src="https://cdn.bootcdn.net/ajax/libs/jquery/3.6.0/jquery.js"></script>
    <script>
      (function (e, t) {
        if (typeof define === "function" && define.amd) {
          define([], t);
        } else if (typeof exports === "object") {
          module.exports = t();
        } else {
          e.Dragify = t();
        }
      })(this, function () {
        var e = function () {
          this.events = {};
        };
        e.prototype = {
          construct: e,
          on: function (e, t) {
            this._getEventInfo(e).push(t);
            return this;
          },
          trigger: function (e) {
            var t = this._getEventInfo(e);
            var n = Array.prototype.slice.call(arguments, 1);
            t.forEach(function (e) {
              e.apply(e, n);
            });
            return this;
          },
          _getEventInfo: function (e) {
            if (!this.events[e]) this.events[e] = [];
            return this.events[e];
          },
          remove: function (e, t) {
            var n = this._getEventInfo(e);
            if (!t) {
              this.events[e] = [];
            } else {
              n.splice(n.indexOf(t), 1);
            }
            return this;
          },
        };
        function t(t) {
          this.$elem = t;
          this.watcher = new e();
          this.init();
        }
        t.prototype = {
          constructor: t,
          init: function () {
            var e = this;
            e.$elem.addEventListener(n[0], function (t) {
              var o = e._getEventInfo(t);
              var i = e.$elem.offsetParent;
              var r = o.clientX - e.$elem.offsetLeft;
              var s = o.clientY - e.$elem.offsetTop;
              var c = i.offsetLeft || 0;
              var a = i.offsetTop || 0;
              var u = document.documentElement.clientWidth;
              var f = document.documentElement.clientHeight;
              var l = e.$elem.offsetWidth;
              var m = e.$elem.offsetHeight;
              var v = getComputedStyle(e.$elem);
              var h =
                v["transition"] ||
                v["-webkit-transition"] ||
                v["-moz-transition"];
              var d = getComputedStyle(e.$elem).zIndex;
              e.watcher.trigger("start", e.$elem);
              document.addEventListener(n[1], p);
              function p(t) {
                var n = e._getEventInfo(t);
                var o = n.clientX - r;
                var i = n.clientY - s;
                if (o + c < 0) o = o - (o + c);
                if (i + a < 0) i = i - (i + a);
                if (o + c + l > u) o = u - (c + l);
                if (i + a + m > f) i = f - (a + m);
                e.$elem.style.position = "absolute";
                e.$elem.style["transition"] =
                  e.$elem.style["-webkit-transition"] =
                  e.$elem.style["-moz-transition"] =
                    "unset";
                e.$elem.style.left = o + "px";
                e.$elem.style.top = i + "px";
                e.$elem.style.zIndex = 19911125;
                e.watcher.trigger("move", e.$elem);
              }
              document.addEventListener(n[2], g);
              function g(t) {
                document.removeEventListener(n[1], p);
                document.removeEventListener(n[2], g);
                e.$elem.style["transition"] =
                  e.$elem.style["-webkit-transition"] =
                  e.$elem.style["-moz-transition"] =
                    h;
                e.$elem.style.zIndex = d;
                e.watcher.trigger("end", e.$elem);
              }
            });
          },
          on: function () {
            this.watcher.on.apply(this.watcher, arguments);
            return this.watcher;
          },
          _getEventInfo: function (e) {
            return t.isTouch() ? e.targetTouches[0] : e;
          },
        };
        t.isTouch = function (e) {
          return (
            "ontouchstart" in window ||
            (window.DocumentTouch &&
              document instanceof window.DocumentTouch) ||
            navigator.maxTouchPoints > 0 ||
            window.navigator.msMaxTouchPoints > 0
          );
        };
        var n = t.isTouch()
          ? ["touchstart", "touchmove", "touchend"]
          : ["mousedown", "mousemove", "mouseup"];
        return t;
      });
    </script>
    <script>
      !(function (e, t) {
        "object" == typeof exports && "object" == typeof module
          ? (module.exports = t())
          : "function" == typeof define && define.amd
          ? define([], t)
          : "object" == typeof exports
          ? (exports.RefLine = t())
          : (e.RefLine = t());
      })(this, function () {
        return (function (e) {
          function t(i) {
            if (n[i]) return n[i].exports;
            var l = (n[i] = {
              i: i,
              l: !1,
              exports: {},
            });
            return e[i].call(l.exports, l, l.exports, t), (l.l = !0), l.exports;
          }
          var n = {};
          return (
            (t.m = e),
            (t.c = n),
            (t.i = function (e) {
              return e;
            }),
            (t.d = function (e, n, i) {
              t.o(e, n) ||
                Object.defineProperty(e, n, {
                  configurable: !1,
                  enumerable: !0,
                  get: i,
                });
            }),
            (t.n = function (e) {
              var n =
                e && e.__esModule
                  ? function () {
                      return e.default;
                    }
                  : function () {
                      return e;
                    };
              return t.d(n, "a", n), n;
            }),
            (t.o = function (e, t) {
              return Object.prototype.hasOwnProperty.call(e, t);
            }),
            (t.p = ""),
            t((t.s = 0))
          );
        })([
          function (e, t, n) {
            "use strict";
            function i(e, t) {
              if (!(e instanceof t))
                throw new TypeError("Cannot call a class as a function");
            }
            var l = (function () {
                function e(e, t) {
                  for (var n = 0; n < t.length; n++) {
                    var i = t[n];
                    (i.enumerable = i.enumerable || !1),
                      (i.configurable = !0),
                      "value" in i && (i.writable = !0),
                      Object.defineProperty(e, i.key, i);
                  }
                }
                return function (t, n, i) {
                  return n && e(t.prototype, n), i && e(t, i), t;
                };
              })(),
              r = {
                xt: null,
                xc: null,
                xb: null,
                yl: null,
                yc: null,
                yr: null,
              };
            for (var o in r) {
              var a = (r[o] = document.createElement("div"));
              a.classList.add("ref-line", o),
                (a.style.cssText =
                  "display:none;opacity:0.7;position:absolute;background:#4DAEFF;z-index:199111250;" +
                  ("x" === o[0]
                    ? "width:100%;height:1px;left:0;"
                    : "width:1px;height:100%;top:0;")),
                (a.show = function () {
                  this.style.display = "block";
                }),
                (a.hide = function () {
                  this.style.display = "none";
                }),
                (a.isShow = function () {
                  return "none" !== this.style.display;
                }),
                document.body.appendChild(a);
            }
            var u = (function () {
              function e() {
                var t =
                  arguments.length > 0 && void 0 !== arguments[0]
                    ? arguments[0]
                    : {};
                i(this, e),
                  (this.options = Object.assign(
                    {
                      gap: 3,
                    },
                    t
                  ));
              }
              return (
                l(e, [
                  {
                    key: "check",
                    value: function (e, t) {
                      var n = this;
                      t =
                        "string" == typeof t ? document.querySelectorAll(t) : t;
                      var i = e.getBoundingClientRect();
                      this.uncheck(),
                        Array.from(t).forEach(function (t) {
                          if (
                            (t.classList.remove("ref-line-active"), t !== e)
                          ) {
                            var l = t.getBoundingClientRect(),
                              o = l.top,
                              a = l.height,
                              u = l.bottom,
                              s = l.left,
                              c = l.width,
                              f = l.right,
                              d = i.width / 2,
                              y = c / 2,
                              h = i.height / 2,
                              p = a / 2,
                              g = {
                                top: [
                                  {
                                    isNearly: n._isNearly(i.top, o),
                                    lineNode: r.xt,
                                    lineValue: o,
                                    dragValue: o,
                                  },
                                  {
                                    isNearly: n._isNearly(i.bottom, o),
                                    lineNode: r.xt,
                                    lineValue: o,
                                    dragValue: o - i.height,
                                  },
                                  {
                                    isNearly: n._isNearly(i.top + h, o + p),
                                    lineNode: r.xc,
                                    lineValue: o + p,
                                    dragValue: o + p - h,
                                  },
                                  {
                                    isNearly: n._isNearly(i.bottom, u),
                                    lineNode: r.xb,
                                    lineValue: u,
                                    dragValue: u - i.height,
                                  },
                                  {
                                    isNearly: n._isNearly(i.top, u),
                                    lineNode: r.xb,
                                    lineValue: u,
                                    dragValue: u,
                                  },
                                ],
                                left: [
                                  {
                                    isNearly: n._isNearly(i.left, s),
                                    lineNode: r.yl,
                                    lineValue: s,
                                    dragValue: s,
                                  },
                                  {
                                    isNearly: n._isNearly(i.right, s),
                                    lineNode: r.yl,
                                    lineValue: s,
                                    dragValue: s - i.width,
                                  },
                                  {
                                    isNearly: n._isNearly(i.left + d, s + y),
                                    lineNode: r.yc,
                                    lineValue: s + y,
                                    dragValue: s + y - d,
                                  },
                                  {
                                    isNearly: n._isNearly(i.right, f),
                                    lineNode: r.yr,
                                    lineValue: f,
                                    dragValue: f - i.width,
                                  },
                                  {
                                    isNearly: n._isNearly(i.left, f),
                                    lineNode: r.yr,
                                    lineValue: f,
                                    dragValue: f,
                                  },
                                ],
                              };
                            for (var N in g)
                              !(function (n) {
                                g[n].forEach(function (i) {
                                  i.isNearly &&
                                    (t.classList.add("ref-line-active"),
                                    (e.style[n] = i.dragValue + "px"),
                                    (i.lineNode.style[n] = i.lineValue + "px"),
                                    i.lineNode.show());
                                });
                              })(N);
                          }
                        });
                    },
                  },
                  {
                    key: "uncheck",
                    value: function () {
                      Object.values(r).forEach(function (e) {
                        return e.hide();
                      }),
                        Array.from(
                          document.querySelectorAll(".ref-line-active")
                        ).forEach(function (e) {
                          return e.classList.remove("ref-line-active");
                        });
                    },
                  },
                  {
                    key: "_isNearly",
                    value: function (e, t) {
                      return Math.abs(e - t) <= this.options.gap;
                    },
                  },
                ]),
                e
              );
            })();
            e.exports = u;
          },
        ]);
      });
    </script>
    <script>
      $(() => {
        $(".one").click((e) => {
          $(".container").append(
            `<div class="box" style="background-color:red;user-select: none;width:100px;height:40px"><div>`
          );
          let boxes   = Array.from(document.querySelectorAll('.box'))
          let refLine = new RefLine()
          boxes.forEach((item) => {
            let drag = new Dragify(item)
            drag
                .on('move', () => {
                    refLine.check(drag.$elem, '.box')
                })
                .on('end', () => {
                    refLine.uncheck()
            })
          })
        })

        $(".many").click((e) => {
          $(".container").append(
            `<div class="box" style="background-color:red;user-select: none;width:200px;height:100px"><div>`
          );
          let boxes   = Array.from(document.querySelectorAll('.box'))
          let refLine = new RefLine()
          boxes.forEach((item) => {
            let drag = new Dragify(item)
            drag
                .on('move', () => {
                    refLine.check(drag.$elem, '.box')
                })
                .on('end', () => {
                    refLine.uncheck()
            })
          })
        })

        $(".upload").click((e) => {
          $(".container").append(
            `<div class="box" style="background-color:red;user-select: none;width:50px;height:50px"><div>`
          );
          let boxes   = Array.from(document.querySelectorAll('.box'))
          let refLine = new RefLine()
          boxes.forEach((item) => {
            let drag = new Dragify(item)
            drag
                .on('move', () => {
                    refLine.check(drag.$elem, '.box')
                })
                .on('end', () => {
                    refLine.uncheck()
            })
          })
        })
      });
    </script>
  </body>
</html>
